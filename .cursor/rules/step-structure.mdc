---

description: Step structure and creation guide for scrollytelling stories
alwaysApply: false
---
# Step Structure & Creation Guide

## Overview

This document defines the step naming convention, content structure, and creation process for scrollytelling stories in the Scrolli platform.

## Step Naming Convention

### **Step Numbering Rules**

- **Step X**: Single step with rich content and/or text
- **Step X.Y**: Sub-steps within Step X (multiple related steps)
- **Use single number** when it's a standalone step
- **Use X.Y format** when there are multiple related sub-steps

### **Content Structure**

- **Step X**: Can contain rich content (maps, 3D, images, videos) AND text
- **Step X.Y**: Sub-steps that build upon Step X's content
- **Progressive storytelling**: Each Y adds more context/explanation

### **Example Structure**

```
Step 1: Warning (current)
Step 2: Map visualization + explanatory text
Step 2.1: Same map + additional context text
Step 2.2: Same map + more detailed explanation
Step 3: 3D visualization + story text
Step 3.1: Same 3D + enhanced narrative
```

## Step Creation Process

### **When Creating a New Step, Provide:**

1. **Step Description**: What this step is about
2. **Step Text**: The actual content to display
3. **Context**: Which rich content to use (map, 3D, image, video, etc.)

### **Template for Step Creation**

```
Step: [Step Number]
Description: [Brief description of what this step contains]
Text: [The actual text content to display]
Context: [Rich content to use - map, 3D, image, video, etc.]
```

### **Implementation Guidelines**

#### **For Single Steps (Step X)**

- Create new rich content if needed
- Add explanatory text
- Set up proper scroll triggers
- Ensure smooth transitions

#### **For Sub-Steps (Step X.Y)**

- Reuse rich content from parent Step X
- Add new text content
- Maintain smooth scrollytelling transitions
- Build upon existing narrative

#### **Rich Content Types**

- **Maps**: Interactive geographic visualizations
- **3D Models**: Three-dimensional objects/scenes
- **Images**: Static or animated images
- **Videos**: Video content with scroll controls
- **Charts**: Data visualizations
- **Combinations**: Multiple rich content types

#### **Text Content Guidelines**

- **Concise**: Keep text brief and impactful
- **Contextual**: Text should relate to rich content
- **Progressive**: Each sub-step adds new information
- **Accessible**: Clear, readable typography

## Technical Implementation

### **File Structure**

```
pages/marmaray/+page.svelte
â”œâ”€â”€ Step 1: Warning
â”œâ”€â”€ Step 2: [Rich Content + Text]
â”œâ”€â”€ Step 2.1: [Same Rich Content + Additional Text]
â”œâ”€â”€ Step 2.2: [Same Rich Content + More Text]
â””â”€â”€ Step 3: [New Rich Content + Text]
```

### **Component Structure**

```svelte
<section class="step-section step-{number}">
  <div class="content-wrapper">
    <!-- Rich Content (maps, 3D, etc.) -->
    <div class="rich-content">
      <!-- Component goes here -->
    </div>

    <!-- Text Content -->
    <div class="text-content">
      <!-- Step text goes here -->
    </div>
  </div>
</section>
```

### **Scroll Management**

- Use scroll triggers for step transitions
- Maintain smooth animations between steps
- Handle rich content state changes
- Ensure responsive behavior

## Usage Examples

### **Example 1: Single Step**

```
Step: 2
Description: European map showing suicide statistics
Text: "The data reveals concerning patterns across Europe..."
Context: European map visualization with country highlighting
```

### **Example 2: Sub-Step**

```
Step: 2.1
Description: Focus on Germany with additional context
Text: "Germany shows particularly high rates in urban areas..."
Context: Same European map, highlight Germany, zoom in
```

### **Example 3: Rich Content + Text**

```
Step: 3
Description: 3D visualization of Marmaray station
Text: "The station's design reflects modern urban planning..."
Context: 3D model of Marmaray station with interactive elements
```

## Best Practices

### **Content Organization**

- Keep related steps together (X, X.1, X.2)
- Maintain narrative flow between steps
- Use consistent styling and typography
- Ensure accessibility standards

### **Performance**

- Optimize rich content loading
- Use lazy loading for heavy assets
- Maintain smooth scroll performance
- Test on various devices

### **User Experience**

- Clear step progression
- Intuitive navigation
- Responsive design
- Loading states for rich content

## Quick Reference

### **Step Types**

- **Single Step**: Step X (standalone)
- **Sub-Step**: Step X.Y (related to Step X)
- **Rich Content**: Maps, 3D, images, videos
- **Text Content**: Explanatory narrative

### **Creation Process**

1. Define step number and type
2. Provide description and text
3. Specify rich content context
4. Implement with proper transitions
5. Test scroll behavior

### **File Locations**

- **Main Story**: `pages/marmaray/+page.svelte`
- **Components**: `src/lib/components/`
- **Assets**: `media-assets/`
- **Styles**: `src/lib/styles/`

## ğŸ”¥ SCROLLYTELLING DEBUG MASTERCLASS
### Problem Solving Pattern for Bidirectional Scroll Issues

Bu bÃ¶lÃ¼m gerÃ§ek bir problem-solving case study'sidir. Marmaray sayfasÄ±nda yaÅŸadÄ±ÄŸÄ±mÄ±z **bidirectional scrollytelling** problemini nasÄ±l Ã§Ã¶zdÃ¼ÄŸÃ¼mÃ¼zÃ¼ adÄ±m adÄ±m anlattÄ±m. Bu pattern'i her scrollytelling bug'Ä±nda kullanabilirsin!

### **ğŸ¯ Problem TanÄ±mÄ±**
```
SORUN: Map gÃ¶rÃ¼nÃ¼yor ama scroll yukarÄ± Ã§Ä±kÄ±nca ikinci text box'a gelmiyor, 
       direkt ilk text box'a atlÄ±yor. Scroll aÅŸaÄŸÄ±-yukarÄ± tutarlÄ± olmuyor.

BEKLENEN: Scroll up/down her iki yÃ¶nde de aynÄ± intermediate step'leri gÃ¶stermeli
```

### **ğŸ•µï¸ Sistematik Debug YaklaÅŸÄ±mÄ±**

#### **ADIM 1: Mevcut Durumu Analiz Et**
```javascript
// Debug HUD'da ÅŸunlarÄ± kontrol et:
- currentStep: hangi step'te olduÄŸun
- showMap: map'in gÃ¶rÃ¼nÃ¼r olup olmadÄ±ÄŸÄ±  
- forceMapShow: viewport-based forcing aktif mi
- scrollingUp: scroll yÃ¶nÃ¼ doÄŸru tespit ediliyor mu
```

#### **ADIM 2: Scroll Direction Detection'Ä± Ä°ncele**
```javascript
// Scroll direction logic'i kontrol et:
let scrollingUp = false;
function throttledScrollHandler() {
  const y = window.scrollY || window.pageYOffset || 0;
  scrollingUp = y < lastScrollY;  // âœ… Bu kÄ±sÄ±m doÄŸru Ã§alÄ±ÅŸÄ±yor
  lastScrollY = y;
}
```

#### **ADIM 3: Map Visibility Logic'ini Analiz Et**
```javascript
// SORUN BURADA! Basit logic bidirectional scroll'u handle edemez:
let showMap = $derived(
  metroStepIndex >= 0 ?
    currentStep <= metroStepIndex || forceMapShow
  : currentStep <= 3
);
```

#### **ADIM 4: Viewport-Based Force Show Logic'ini GeliÅŸtir**
```javascript
// ESKÄ° (PROBLEM): Sadece intersect'te gÃ¶ster
forceMapShow = inView;

// YENÄ° (Ã‡Ã–ZÃœM): Bidirectional approach detection
const approachingFromBelow = scrollingUp && r.top < vh * 1.2;     // Early show when scrolling up
const approachingFromAbove = !scrollingUp && r.bottom > vh * -0.2; // Extended show when scrolling down
forceMapShow = inView || approachingFromBelow || approachingFromAbove;
```

#### **ADIM 5: CSS Transform Problemini KeÅŸfet**
```javascript
// ğŸ” GERÃ‡EK PROBLEM BURADA SAKLIYDI!
// showMap: true olmasÄ±na raÄŸmen map gÃ¶rÃ¼nmÃ¼yordu

// SORUNLU KOD:
style:transform={showMap ? mapExitTransform : 'translateY(-100vh)'}
// mapExitTransform = `translateY(-${mapExitProgress * 100}vh)` 
// Bu da map'i viewport'un Ã¼stÃ¼ne Ã§Ä±karÄ±yordu!

// Ã‡Ã–ZÃœM:
style:transform={showMap ? 'translateY(0)' : 'translateY(-100vh)'}
style:opacity={showMap ? 1 : 0}
```

### **ğŸ’¡ Debug Pattern - 5 Golden Rules**

#### **Rule 1: Debug HUD is Your Best Friend**
```javascript
// Always add comprehensive debug info:
{#if showHUD}
  <div class="debug-hud">
    <div>step: {currentStep}</div>
    <div>metroStepIndex: {metroStepIndex}</div>
    <div>scrollingUp: {scrollingUp ? 'â†‘' : 'â†“'}</div>
    <div>forceMapShow: {forceMapShow ? 'true' : 'false'}</div>
    <div>showMap: {showMap ? 'true' : 'false'}</div>
    <div>mapExitProgress: {mapExitProgress.toFixed(2)}</div>
  </div>
{/if}
```

#### **Rule 2: Logic vs Styling Separation**
```
âŒ YANLIÅ: Logic doÄŸru ama stil problemi var
âœ… DOÄRU: Her ikisini de ayrÄ± ayrÄ± test et

1. Ã–nce logic'i kontrol et (showMap true/false doÄŸru mu?)
2. Sonra styling'i kontrol et (CSS transform/opacity doÄŸru mu?)
```

#### **Rule 3: Bidirectional Thinking**
```javascript
// Her scroll detection iÃ§in iki yÃ¶n dÃ¼ÅŸÃ¼n:
const scrollDown_behavior = /* AÅŸaÄŸÄ± scroll davranÄ±ÅŸÄ± */;
const scrollUp_behavior = /* YukarÄ± scroll davranÄ±ÅŸÄ± */;

// Ä°kisi de aynÄ± step'leri gÃ¶stermeli!
```

#### **Rule 4: Viewport Thresholds**
```javascript
// Smooth transitions iÃ§in threshold'larÄ± geniÅŸlet:
const approachingFromBelow = scrollingUp && r.top < vh * 1.2;   // 120% - Early trigger
const approachingFromAbove = !scrollingUp && r.bottom > vh * -0.2; // -20% - Extended trigger
```

#### **Rule 5: Transform vs Opacity**
```css
/* Transform visibility sorunlarÄ±na sebep olabilir */
transform: translateY(-100vh); /* Map viewport dÄ±ÅŸÄ±na Ã§Ä±kar */

/* Hem transform hem opacity kullan: */
transform: showMap ? 'translateY(0)' : 'translateY(-100vh)';
opacity: showMap ? 1 : 0;
```

### **ğŸš€ Ã‡Ã¶zÃ¼m Implementasyonu**

#### **Enhanced Viewport Logic**
```javascript
if (metroStepIndex >= 0) {
  const metroEl = steps[metroStepIndex] as HTMLElement;
  const r = metroEl.getBoundingClientRect();
  const inView = r.top < vh * 0.95 && r.bottom > vh * 0.05;
  
  // ğŸ”¥ Magic happens here - bidirectional approach detection
  const approachingFromBelow = scrollingUp && r.top < vh * 1.2;
  const approachingFromAbove = !scrollingUp && r.bottom > vh * -0.2;
  
  forceMapShow = inView || approachingFromBelow || approachingFromAbove;
}
```

#### **Fixed CSS Transform**
```svelte
<div
  class="fullwidth-map-container"
  style:transform={showMap ? 'translateY(0)' : 'translateY(-100vh)'}
  style:opacity={showMap ? 1 : 0}
  style:pointer-events={showMap ? 'auto' : 'none'}
>
```

### **âœ… SonuÃ§: Unified Scrollytelling Experience**

```
Scroll Down: Map â†’ First Text â†’ Second Text â†’ Map Transition âœ…
Scroll Up:   Map Transition â†’ Second Text â†’ First Text â†’ Map âœ…

Ä°kisi de aynÄ± intermediate step'leri gÃ¶steriyor! ğŸ‰
```

### **ğŸ§  Ã–ÄŸrenilen Pattern'ler**

1. **Debug First**: Ã–nce ne olduÄŸunu anla, sonra Ã§Ã¶z
2. **Logic vs Style**: Ä°kisini ayrÄ± ayrÄ± test et  
3. **Bidirectional**: Her zaman iki yÃ¶nÃ¼ dÃ¼ÅŸÃ¼n
4. **Viewport Thresholds**: Smooth geÃ§iÅŸler iÃ§in threshold'larÄ± geniÅŸlet
5. **Transform Pitfalls**: CSS transform'lar visibility'yi etkileyebilir

Bu pattern'i kullanarak gelecekte tÃ¼m scrollytelling bug'larÄ±nÄ± Ã§Ã¶zebilirsin! ğŸ”¥
